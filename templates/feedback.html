{% extends "base.html" %}

{% block content %}
<div class="max-w-xl mx-auto bg-white p-8 rounded-xl shadow-2xl border border-pink-100">
    <h1 class="text-3xl font-bold mb-6 text-pink-700 text-center">Share Your Experience</h1>
    
    <p class="text-lg text-gray-600 mb-6 text-center">
        Your feedback on the quiz generation, adaptive engine, or overall flow helps us improve the application!
    </p>

    <form method="POST" action="{{ url_for('feedback') }}" id="feedbackForm">
        
        <div class="mb-4">
            <label class="block text-gray-700 mb-2 font-semibold">What is your feedback about?</label>
            <select name="feedback_type" required 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-pink-500 transition-colors">
                <option value="AI Generation">AI Question Generation</option>
                <option value="Adaptive Logic">Adaptive Difficulty Logic</option>
                <option value="UI/UX">Interface & Usability</option>
                <option value="Bug Report">Bug Report (Thanks!)</option>
                <option value="General Suggestion">General Suggestion</option>
            </select>
        </div>

        <div class="mb-4">
            <label class="block text-gray-700 mb-2 font-semibold">Overall Satisfaction (1 - 5)</label>
            <div class="star-rating flex flex-row-reverse justify-end w-full bg-gray-100 p-3 rounded-lg">
                {% for i in range(5, 0, -1) %}
                <input type="radio" id="star-{{ i }}" name="rating" value="{{ i }}" required class="hidden peer">
                <label for="star-{{ i }}" 
                       class="text-3xl cursor-pointer text-gray-400 transition-colors duration-200 hover:text-pink-500"
                       title="{{ i }} stars">
                    <i class="fas fa-star"></i>
                </label>
                {% endfor %}
            </div>
        </div>
        <div class="mb-6">
            <label class="block text-gray-700 mb-2 font-semibold">Detailed Comments</label>
            <textarea name="comments" rows="6" required
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-pink-500 resize-y"
                      placeholder="Be as specific as possible..."></textarea>
        </div>
        
        <button type="submit" class="w-full bg-pink-600 text-white py-3 rounded-lg hover:bg-pink-700 font-bold text-lg transition-colors">
            Submit Feedback
        </button>
    </form>
    
    <p class="mt-4 text-center text-sm">
        <a href="/dashboard" class="text-blue-600 hover:text-blue-800">Back to Dashboard</a>
    </p>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const starContainer = document.querySelector('.star-rating');
    
    if (starContainer) {
        // --- Core Star Rating Logic ---
        
        // Function to set the color of stars based on the given rating value
        function updateStarColors(rating) {
            const stars = starContainer.querySelectorAll('label i');
            
            stars.forEach((starIcon, index) => {
                // The index is 0-based, but we iterate from 5 to 1 (reversed)
                // We want to fill the first 'rating' stars. Since they are arranged LTR but visually RTL (CSS flex-direction: reverse), 
                // we check if the star's index is greater than or equal to the count of stars remaining from the right.
                const isFilled = (5 - index) <= rating;

                if (isFilled) {
                    starIcon.style.color = 'rgb(236, 72, 153)'; // pink-600 equivalent
                } else {
                    starIcon.style.color = 'rgb(156, 163, 175)'; // gray-400 equivalent
                }
            });
        }

        // 1. Hover/Mousemove listener (for immediate visual feedback)
        starContainer.addEventListener('mousemove', (event) => {
            const label = event.target.closest('label');
            if (label) {
                // Get the star value from the linked input (via the 'for' attribute)
                const inputId = label.getAttribute('for');
                const ratingInput = document.getElementById(inputId);
                
                if (ratingInput) {
                    // Temporarily update colors based on the hovered star's value
                    updateStarColors(parseInt(ratingInput.value));
                }
            }
        });

        // 2. Mouseleave listener (revert to checked state or default if none checked)
        starContainer.addEventListener('mouseleave', () => {
            const checkedStar = starContainer.querySelector('input:checked');
            if (checkedStar) {
                updateStarColors(parseInt(checkedStar.value));
            } else {
                updateStarColors(0); // Revert to all gray
            }
        });

        // 3. Click listener (permanent selection)
        starContainer.addEventListener('click', (event) => {
            const label = event.target.closest('label');
            if (label) {
                const inputId = label.getAttribute('for');
                const ratingInput = document.getElementById(inputId);
                
                if (ratingInput) {
                    ratingInput.checked = true;
                    updateStarColors(parseInt(ratingInput.value));
                }
            }
        });

        // 4. Initial Load: Check if a rating is pre-selected (not likely in this use case, but good practice)
        const initialChecked = starContainer.querySelector('input:checked');
        if (initialChecked) {
            updateStarColors(parseInt(initialChecked.value));
        } else {
             updateStarColors(0);
        }
    }
});
</script>
{% endblock %}